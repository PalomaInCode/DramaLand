<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Dramaland</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashstyle.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>Dramaland</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="perfil.html" class="active" onclick="changePage('home')">Página Inicial</a></li>
                    <li><a href="editarPerfil.html" onclick="changePage('profile')">Editar Perfil</a></li>
                    <li><a href="#" onclick="logout()">Sair</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h2>Bem-vinda, <span id="profileNameDisplay">Fã Oficial de Doramas</span></h2>
                    <input type="text" id="searchInput" placeholder="Buscar seu drama favorito..." oninput="searchDrama()">
                </div>
                <div class="profile" onclick="openPhotoModal()">
                    <img id="profilePic" src="https://via.placeholder.com/45" alt="Avatar">
                </div>
            </header>

            <!-- Home Section -->
            <section id="home" class="content-section active">
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>Último Dorama Assistido</h3>
                        <p id="lastWatchedDrama">Ep. 10 - A Despedida</p>
                    </div>
                    <div class="card">
                        <h3>Favoritos</h3>
                        <p id="favoritesCount">10 doramas na lista</p>
                    </div>
                    <div class="card">
                        <h3>Próximos Episódios</h3>
                        <p id="nextEpisode">Episódio 12 de True Beauty Pendente</p>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="charts">
                    <div class="chart-container">
                        <h3>Gênero Mais Assistido</h3>
                        <canvas id="genreChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Quantidade de Dramas Assistidos</h3>
                        <canvas id="countChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Episódios Assistidos ao Longo do Tempo</h3>
                        <canvas id="episodesChart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        function changePage(pageId) {
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function logout() {
            alert("Você foi desconectado!");
            window.location.href = "login.html";
        }

        function searchDrama() {
            const searchQuery = document.getElementById("searchInput").value.toLowerCase();
            console.log("Buscando por:", searchQuery);
        }

        async function saveProfile(event) {
            event.preventDefault();  // Impede o envio do formulário

            const profileName = document.getElementById('profileName').value;
            const lastDrama = document.getElementById('lastDrama').value;
            const favorites = document.getElementById('favorites').value;
            const genresWatched = document.getElementById('genresWatched').value.split(',');
            const countWatched = document.getElementById('countWatched').value.split(',').map(Number);

            const profileData = {
                name: profileName || 'Fã Oficial de Doramas',
                lastDrama: lastDrama || 'Nenhum drama assistido',
                favorites: favorites || 0,
                genres: genresWatched.map(g => g.trim()),
                countWatched: countWatched,
            };

            // Atualiza a exibição de informações no painel
            document.getElementById('lastWatchedDrama').textContent = profileData.lastDrama;
            document.getElementById('favoritesCount').textContent = `${profileData.favorites} dramas na lista de favoritos`;

            // Salva o perfil no localStorage
            localStorage.setItem('profileData', JSON.stringify(profileData));

            alert('Perfil salvo com sucesso!');
            updateCharts(profileData);
        }

        function updateCharts(profileData) {
            // Gênero mais assistido (gráfico de pizza)
            new Chart(document.getElementById('genreChart'), {
                type: 'pie',
                data: {
                    labels: profileData.genres,
                    datasets: [{
                        data: profileData.genres.map(() => Math.floor(Math.random() * 10) + 1),
                        backgroundColor: ['#f9a8d4', '#f55d9e', '#f1c4d4', '#f2a6c6', '#ed1f90'],
                    }]
                },
                options: { responsive: true }
            });

            // Quantidade de dramas assistidos (gráfico de barras)
            new Chart(document.getElementById('countChart'), {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [{
                        label: 'Dramas Assistidos',
                        data: profileData.countWatched,
                        backgroundColor: '#f9a8d4',
                    }]
                },
                options: { responsive: true }
            });

            // Episódios assistidos ao longo do tempo (gráfico de linha)
            new Chart(document.getElementById('episodesChart'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [{
                        label: 'Episódios Assistidos',
                        data: profileData.countWatched.map(c => c * 3),
                        borderColor: '#f55d9e',
                        fill: false
                    }]
                },
                options: { responsive: true }
            });
        }

        // Carregar dados do perfil se houver
        const savedProfile = JSON.parse(localStorage.getItem('profileData'));
        if (savedProfile) {
            document.getElementById('profileNameDisplay').textContent = savedProfile.name;
            document.getElementById('lastWatchedDrama').textContent = savedProfile.lastDrama;
            document.getElementById('favoritesCount').textContent = `${savedProfile.favorites} dramas na lista de favoritos`;
            updateCharts(savedProfile);
        }

        
    </script>
</body>
</html>
