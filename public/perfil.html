<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Dramaland</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashstyle.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>Dramaland</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" onclick="changePage('home')">Página Inicial</a></li>
                    <li><a href="#" onclick="changePage('profile')">Editar Perfil</a></li>
                    <li><a href="#" onclick="logout()">Sair</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h2>Bem-vinda, </h2>
                    <input type="text" id="searchInput" placeholder="Buscar seu drama favorito..." oninput="searchDrama()">
                </div>
                <div class="profile" onclick="changePage('profile')">
                    <img id="profilePic" src="https://via.placeholder.com/45" alt="Avatar">
                    <span id="profileNameDisplay">Fã Oficial de Doramas</span>
                </div>
            </header>

            <!-- Home Section -->
            <section id="home" class="content-section active">
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>Último Drama Assistido</h3>
                        <p id="lastWatchedDrama">Ep. 10 - A Despedida</p>
                    </div>
                    <div class="card">
                        <h3>Favoritos</h3>
                        <p id="favoritesCount">10 dramas na lista de favoritos</p>
                    </div>
                    <div class="card">
                        <h3>Próximos Episódios</h3>
                        <p id="nextEpisode">Assista o próximo episódio amanhã!</p>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="charts">
                    <div class="chart-container">
                        <h3>Gênero Mais Assistido</h3>
                        <canvas id="genreChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Quantidade de Dramas Assistidos</h3>
                        <canvas id="countChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile" class="content-section">
                <h3>Editar Perfil</h3>
                <form id="editProfileForm">
                    <div class="form-group">
                        <label for="profileName">Nome</label>
                        <input type="text" id="profileName" placeholder="Seu nome">
                    </div>
                    <div class="form-group">
                        <label for="lastDrama">Último Drama Assistido</label>
                        <input type="text" id="lastDrama" placeholder="Título do último drama">
                    </div>
                    <div class="form-group">
                        <label for="favorites">Quantidade de Favoritos</label>
                        <input type="number" id="favorites" placeholder="Número de favoritos">
                    </div>
                    <div class="form-group">
                        <label for="genresWatched">Gêneros Mais Assistidos (separados por vírgula)</label>
                        <input type="text" id="genresWatched" placeholder="Romance, Comédia, Drama">
                    </div>
                    <div class="form-group">
                        <label for="countWatched">Quantidade de Dramas Assistidos</label>
                        <input type="text" id="countWatched" placeholder="Número de dramas assistidos por mês">
                    </div>
                    <button type="button" onclick="saveProfile()">Salvar Perfil</button>
                </form>
            </section>
        </main>
    </div>

    <script>
        const apiEndpoint = "https://seu-servidor.com/api/profile"; // Substitua pelo endpoint do seu backend.

        function changePage(pageId) {
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function logout() {
            alert("Você foi desconectado!");
            window.location.href = "login.html";
        }

        function searchDrama() {
            const searchQuery = document.getElementById("searchInput").value.toLowerCase();
            console.log("Buscando por:", searchQuery);
        }

        async function saveProfile() {
            const profileName = document.getElementById('profileName').value;
            const lastDrama = document.getElementById('lastDrama').value;
            const favorites = document.getElementById('favorites').value;
            const genresWatched = document.getElementById('genresWatched').value.split(',');
            const countWatched = document.getElementById('countWatched').value.split(',').map(Number);

            const profileData = {
                name: profileName || 'Fã Oficial de Doramas',
                lastDrama: lastDrama || 'Nenhum drama assistido',
                favorites: favorites || 0,
                genres: genresWatched.map(g => g.trim()),
                countWatched: countWatched,
            };

            try {
                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData),
                });

                if (!response.ok) throw new Error('Erro ao salvar os dados no servidor');

                alert('Perfil salvo com sucesso!');
                updateCharts(profileData);
            } catch (error) {
                console.error(error);
                alert('Ocorreu um erro ao salvar os dados. Tente novamente.');
            }
        }

        function updateCharts(profileData) {
            // Atualiza gênero mais assistido
            new Chart(document.getElementById('genreChart'), {
                type: 'pie',
                data: {
                    labels: profileData.genres,
                    datasets: [{
                        data: profileData.genres.map(() => Math.floor(Math.random() * 10) + 1),
                        backgroundColor: ['#f9a8d4', '#f55d9e', '#f1c4d4', '#f2a6c6', '#ed1f90'],
                    }]
                },
                options: { responsive: true }
            });

            // Atualiza quantidade de dramas assistidos
            new Chart(document.getElementById('countChart'), {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [{
                        label: 'Dramas Assistidos',
                        data: profileData.countWatched,
                        backgroundColor: '#f9a8d4',
                    }]
                },
                options: { responsive: true }
            });
        }
    </script>
</body>
</html>
